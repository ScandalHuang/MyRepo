
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui" 
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:i18n="http://innolux.com/i18n">
		<h:form id="listPrtypeBudgetForm" prependId="false">
		預算月份：
        		<p:selectOneMenu value="#{ListPrtypeBudgetBean.form.year}">
							<f:selectItems value="#{ListPrtypeBudgetBean.form.dateOption.year}" />
							<p:ajax update="listPrtypeBudget" process="@form"
								listener="#{ListPrtypeBudgetBean.onSearch}" />
				</p:selectOneMenu>年
				<p:selectOneMenu value="#{ListPrtypeBudgetBean.form.month}">
							<f:selectItems value="#{ListPrtypeBudgetBean.form.dateOption.month}" />
							<p:ajax update="listPrtypeBudget" process="@form"
								listener="#{ListPrtypeBudgetBean.onSearch}" />
				</p:selectOneMenu>月
				<br/>
				TYPE：
				<p:selectOneMenu value="#{ListPrtypeBudgetBean.form.selectBudgetType}">
							<f:selectItem itemLabel="請選擇" itemValue=""/>
								<ui:repeat value="#{ListPrtypeBudgetBean.form.typeOption.entrySet().toArray()}" 
									var="entry">
									<c:if test="">
										<f:selectItem itemLabel="#{entry.value}" itemValue="#{entry.key}"/>
									</c:if>
								</ui:repeat>
							<f:selectItems value="#{ListPrtypeBudgetBean.form.typeOption}" />
							<p:ajax update="@form" process="@form"
								listener="#{ListPrtypeBudgetBean.onSearch}" />
				</p:selectOneMenu>
				<br/>
				<i18n:outputText value="location.site" />：
				<p:selectOneMenu style="width:250px;" converter="SerializesConverter"
					value="#{ListPrtypeBudgetBean.form.sLocationSiteMap}"
					filter="true" filterMatchMode="startsWith" >
					<f:selectItem itemLabel="請選擇" itemValue="" />
					<f:selectItems value="#{LoginInfoBean.userLSMap.values()}" var="userLSMap"
										itemLabel="#{userLSMap.locationSite}"  itemValue="#{userLSMap}" />
					<p:ajax update="@form" listener="#{ListPrtypeBudgetBean.onSearch}" />
				</p:selectOneMenu>
			<center>
			<p:dataTable var="listPrtypeBudget" paginatorPosition="bottom"
				id="listPrtypeBudget" paginator="true" rows="10"
				value="#{ListPrtypeBudgetBean.form.listPrtypeBudget}"
				rowKey="#{listPrtypeBudget.prtypeBudgetId}"
				selection="#{ListPrtypeBudgetBean.form.deleteList}">
				<f:facet name="header">
					<h:outputText rendered="#{ListPrtypeBudgetBean.form.selectPrtype!=''}"
					value="#{SystemConfigBean.parameterMap[ListPrtypeBudgetBean.form.selectPrtype]}" />
					<font color="red">(若清單無部門，則代表不管控)</font><br/>
				<p:commandButton value="選取全部" icon="ui-icon-circle-check"
					rendered="#{ListPrtypeBudgetBean.form.listPrtypeBudget.size()>0}"
					actionListener="#{ListPrtypeBudgetBean.onSelectAll}" 
					update="listPrtypeBudget" />
				<p:commandButton value="刪除清單" icon="ui-icon-trash"
					rendered="#{ListPrtypeBudgetBean.form.listPrtypeBudget.size()>0}"
					oncomplete="PF('deleteConfirmPRBDialog').show();" />
				</f:facet>
				<p:column selectionMode="multiple" exportable="false"
				style="text-align:center;width:20px" />
				<p:column>
					<f:facet name="header">
							DEPT_NO(部門代碼)
						</f:facet>
					<h:outputText value="#{listPrtypeBudget.deptNo}" />
				</p:column>
				<p:column exportable="false">
					<f:facet name="header">
							BUDGET_TYPE
						</f:facet>
					<h:outputText value="#{SystemConfigBean.parameterMap[listPrtypeBudget.budgetType]}" />
				</p:column>
				<p:column>
					<f:facet name="header">
							TOTAL_BUDGET(總預算)
						</f:facet>
					<h:outputText value="#{listPrtypeBudget.totalBudget}" />
				</p:column>
				<p:column exportable="false">
					<f:facet name="header">
							LASTUPDATE_DATE
						</f:facet>
					<h:outputText value="#{listPrtypeBudget.lastupdateDate}" >
								<f:convertDateTime pattern="yyyy-MM-dd" timeZone="GMT+8" />
							</h:outputText>
				</p:column>
				<p:column>
					<f:facet name="header">
							BUDGET_MONTH(預算月份)
						</f:facet>
					<h:outputText value="#{listPrtypeBudget.budgetMonth}" />
				</p:column>
				<p:column>
					<f:facet name="header">
							REMARK
						</f:facet>
					<h:outputText value="#{listPrtypeBudget.remark}" />
				</p:column>
			</p:dataTable>
			<p:panelGrid columns="2">
			<p:panel header="Export All Data">
				<h:commandLink>
					<p:graphicImage value="../../resources/images/excel.png" />
					<p:dataExporter type="xls" target="listPrtypeBudget"
						fileName="#{currentDate.getTime()}E" />
				</h:commandLink>
			</p:panel>
			<p:panel header="Upload Data" 
				rendered="#{ListPrtypeBudgetBean.form.selectBudgetType!=null
					and ListPrtypeBudgetBean.form.sLocationSiteMap!=null}">
				<i18n:outputText value="upload.excel" />：
					<p:commandButton icon="ui-icon-disk"
					update=":fileUploadExcelForm"
					action="#{FileUploadExcelBean.excel(6,1)}"
					 
					oncomplete="PF('ExcelFileUploadDialog').show();">
					<f:setPropertyActionListener target="#{FileUploadExcelBean.object}"
						value="#{ListPrtypeBudgetBean}" />
					<f:setPropertyActionListener
						target="#{FileUploadExcelBean.updateView}"
						value="tabView:listPrtypeBudgetForm" />
				</p:commandButton>
			</p:panel>
		</p:panelGrid>
		</center>
		</h:form>
		
		<p:confirmDialog id="deleteConfirmPRBDialog" message="確定刪除清單?" width="300"
			header="確定刪除清單" widgetVar="deleteConfirmPRBDialog" appendTo="@(body)">
			<h:form id="deleteConfirmDialogPRBForm" prependId="false">
				<p:commandButton value="Yes Sure"
					oncomplete="PF('deleteConfirmPRBDialog').hide();"
					actionListener="#{ListPrtypeBudgetBean.onDelete}"
					update=":tabView:listPrtypeBudgetForm"
					 
					icon="ui-icon-circle-check" />
				<p:commandButton value="Not Yet"
					onclick="PF('deleteConfirmPRBDialog').hide();" type="button"
					icon="ui-icon-close" />
			</h:form>
		</p:confirmDialog>
</ui:composition>
