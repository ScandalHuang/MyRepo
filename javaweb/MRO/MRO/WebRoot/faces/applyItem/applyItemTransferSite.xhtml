
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:i18n="http://innolux.com/i18n">
	<h:form id="ItemTransferHeaderForm" prependId="false">
		<c:set var="form" value="#{ApplyItemTransferSiteBean.itemTransferSiteForm}"  />
		<c:set var="header"  value="#{form.itemTransferHeaderApply}" />
		<c:set var="hEditFlag" value="#{header.applyHeaderId ==null and form.editButton?true:false}"  />
		<h:panelGrid columns="6" cellpadding="2">
			<p:commandButton value="開立新單" update=":tabView" icon="ui-icon-plus"
				actionListener="#{ApplyItemTransferSiteBean.newItemTransferHeaderApply}" />
			<p:commandButton value="儲存" update=":tabView"
				icon="ui-icon-disk"
				actionListener="#{ApplyItemTransferSiteBean.onApplySave('save')}"
				rendered="#{form.editButton}" />
			<p:commandButton value="送審申請單" icon="ui-icon-circle-check"
				process="@form"
				update=":submitConfirmDialogForm"
				rendered="#{form.editButton and header.applyHeaderId!=null}"
				oncomplete="PF('submitConfirmDialog').show();" />
			<p:commandButton value="刪除申請單" icon="ui-icon-trash"
				rendered="#{form.editButton and header.applyHeaderId!=null}"
				oncomplete="PF('deleteConfirmDialog').show();" />
			<p:commandButton value="簽核預覽" icon="ui-icon-search"
				actionListener="#{ApplyItemTransferSiteBean.onSignPreView}"
				update=":signPreView"
				rendered="#{form.editButton and header.applyHeaderId!=null}"
				oncomplete="PF('signPreViewDialog').show();" />
		</h:panelGrid>
		<p:separator />
		<i18n:outputText style="color:red;" value="NonNull" />
		<p:panelGrid id="header" style="width:100%;word-break:break-all;">
			<p:row>
				<p:column style="vertical-align:top;width:50%">
					<p:panelGrid style="width:100%;word-break:break-all;">
						<f:facet name="header">
							<p:row>
								<p:column colspan="2">
									<i18n:outputText value="line.info" />
								</p:column>
							</p:row>
						</f:facet>
						<p:row>
							<p:column style="width:120px">
								<i18n:outputText value="apply.num" style="font-weight: bold;" />  :
							</p:column>
							<p:column>#{header.applyHeaderNum}</p:column>
						</p:row>
						<p:row>
							<p:column>
								<i18n:outputText value="item_status" style="font-weight: bold;" /> :
							</p:column>
							<p:column>#{SystemConfigBean.parameterMap[header.status]}</p:column>
						</p:row>
						<p:row>
							<p:column>
								<h:outputText value="ACTION" style="font-weight: bold;" /> :
						</p:column>
							<p:column rendered="#{!hEditFlag}">
								#{form.actionTypeMapping[header.action]}
							</p:column>
							<p:column rendered="#{hEditFlag}">
								<p:selectOneMenu value="#{header.action}" >
									<f:selectItems value="#{form.actionTypeOption}" />
								</p:selectOneMenu>
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<i18n:outputText style="color:red;" value="NonNullMark" />
								<i18n:outputText value="class_structure_id"
									style="font-weight: bold;" />  :
									</p:column>
							<p:column rendered="#{!hEditFlag}">
								<h:outputText value="#{header.classstructureid}" />
							</p:column>
							<p:column rendered="#{hEditFlag}">
								<p:inputText value="#{header.classstructureid}" readonly="true" />
								<p:commandButton icon="ui-icon-search"
									oncomplete="PF('listClassstructureFormDialog').show();">
									<f:setPropertyActionListener
										target="#{ListClassstructureBean.object}"
										value="#{ApplyItemTransferSiteBean}" />
									<f:setPropertyActionListener
										target="#{ListClassstructureBean.updateView}"
										value="tabView:ItemTransferHeaderForm" />
								</p:commandButton>

							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<i18n:outputText value="apply.by" style="font-weight: bold;" /> :
									</p:column>
							<p:column> #{LoginInfoBean.getPersonName(header.createBy)}</p:column>
						</p:row>
						<p:row>
							<p:column>
								<i18n:outputText value="apply.item.site" style="font-weight: bold;" />  :
							</p:column>
							<p:column rendered="#{!hEditFlag}"> #{header.locationSite} </p:column>
							<p:column rendered="#{hEditFlag}">
								<p:selectOneMenu value="#{header.locationSite}" >
									<f:selectItem itemLabel="請選擇" itemValue="" />
									<f:selectItems value="#{SystemConfigBean.lSiteOption}" />
								</p:selectOneMenu>
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<i18n:outputText value="dept_code" style="font-weight: bold;" /> :
							</p:column>
							<p:column>#{header.deptcode}</p:column>
						</p:row>
						<p:row>
							<p:column>
								<i18n:outputText value="use.msg" style="font-weight: bold;" />
								<i18n:outputText value="command" style="font-weight: bold;" />  :
							</p:column>
							<p:column rendered="#{!form.editButton}">
								<h:outputText
									value="#{header.headerRemark}"
									style="white-space: pre-wrap; word-wrap: break-word;" />
							</p:column>
							<p:column rendered="#{form.editButton}">
								<p:inputTextarea rows="5" cols="35" maxlength="166" autoResize="false"
									value="#{header.headerRemark}" />
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<i18n:outputText value="apply_date" style="font-weight: bold;" /> :
									</p:column>
							<p:column>
								<h:outputText value="#{header.createDate}">
									<f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss" timeZone="GMT+8" />
								</h:outputText>
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<i18n:outputText value="transdate" style="font-weight: bold;" /> :
							</p:column>
							<p:column>
								<h:outputText value="#{header.lastUpdateDate}">
									<f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss" timeZone="GMT+8" />
								</h:outputText>
							</p:column>
						</p:row>
					</p:panelGrid>
				</p:column>
				<p:column style="vertical-align:top;width:50%">
					<p:panelGrid id="file" style="margin-top:20px;width:100%;word-break:break-all;">
						<f:facet name="header">
							<p:row>
								<p:column colspan="2">
									<i18n:outputText value="file" style="font-weight: bold;" />
									<!-- font color="red">(上傳檔案前請先點選儲存)</font-->
									<i18n:outputText value="Notice.toUploadAttachement"
										rendered="#{header.applyHeaderId==null}"
										style="color:red;text-align:center" />
								</p:column>
							</p:row>
						</f:facet>
						<p:row>
							<p:column style="width:100px;text-align:left;">
								<i18n:outputText value="attachmentList" style="font-weight: bold;" />  :
									</p:column>
							<p:column>
								<p:commandButton icon="ui-icon-disk"
									value="(#{form.dowloadFileMap[form.fileHeaderType]})"
									action="#{FileUploadBean.onFileType(2,3,
									form.fileHeaderType,header.applyHeaderId,
									form.dowloadFileMap,'tabView:file',form.editButton)}"
									rendered="#{header.applyHeaderId!=null}" />
							</p:column>
						</p:row>
					</p:panelGrid>
				</p:column>
			</p:row>
		</p:panelGrid>
		<br />
		<p:separator />
		<br />
		<p:dataTable var="listItemTransferLineApply" id="listItemTransferLineApply"
			value="#{form.listItemTransferLineApply}"
			paginatorPosition="bottom" paginator="true" rows="10"
			rowKey="#{listItemTransferLineApply.applyLineId}">
			<f:facet name="header">
				<p:row>
					<p:column colspan="2">
						<i18n:outputText value="Apply.Detail" />
						<p:commandButton icon="ui-icon-search" value="新增料號"
							update=":listItemCommonForm"
							rendered="#{header.applyHeaderId !=null and form.editButton}"
							oncomplete="PF('listItemCommonFormDialog').show();">
							<f:setPropertyActionListener
								target="#{ListItemCommonBean.object}"
								value="#{ApplyItemTransferSiteBean}" />
							<f:setPropertyActionListener
								target="#{ListItemCommonBean.updateView}"
								value="tabView:listItemTransferLineApply" />
						</p:commandButton>
					</p:column>
				</p:row>
			</f:facet>
			<p:column headerText="Delete" style="width:30px;text-align:center;" rendered="#{form.editButton}">
				<p:commandButton 
					update="listItemTransferLineApply"
					style="width:20px;height:20px;"
					actionListener="#{ApplyItemTransferSiteBean.deleteItemTransferLineApply(
					listItemTransferLineApply)}"
					icon="ui-icon-close"  />
			</p:column>
			<p:column style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="line" />
				</f:facet>
				<h:outputText value="#{listItemTransferLineApply.lineNum}" />
			</p:column>
			<p:column style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="itemnum" />
				</f:facet>
				<h:outputText value="#{listItemTransferLineApply.itemnum}" />
			</p:column>
			<p:column style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="description" />
				</f:facet>
				<h:outputText value="#{listItemTransferLineApply.description}" />
			</p:column>
			<p:column style="text-align:center;" rendered="#{!form.editButton}">
				<f:facet name="header">
					<i18n:outputText value="apply.status" />
				</f:facet>
				<h:outputText
					value="#{form.lineStatusMapping[listItemTransferLineApply.status]}" />
			</p:column>
			<p:column style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText style="color:red;" value="NonNullMark" /> 
					<i18n:outputText value="command" />
				</f:facet>
				<p:inputText value="#{listItemTransferLineApply.lineRemark}" maxlength="50" rendered="#{form.editButton}" />
				<h:outputText value="#{listItemTransferLineApply.lineRemark}" rendered="#{!form.editButton}" escape="false" />
			</p:column>
			<p:column  style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="file" />
				</f:facet>
				<i18n:outputText value="Notice.toUploadAttachement"
					rendered="#{listItemTransferLineApply.applyLineId==null}"
					style="color:red;text-align:center" />
				<p:commandButton icon="ui-icon-disk"
					value="(#{form.dowloadFileMap[listItemTransferLineApply.applyLineId]})"
					action="#{FileUploadBean.onFileType(2,3,
							form.fileLineType,listItemTransferLineApply.applyLineId,
							form.dowloadFileMap,'tabView:listItemTransferLineApply',
							form.editButton)}"
					rendered="#{listItemTransferLineApply.applyLineId!=null}" />
			</p:column>
			<p:column style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="item.status" />
				</f:facet>
				<h:outputText value="#{listItemTransferLineApply.extraRemark}" escape="false" />
			</p:column>
		</p:dataTable>
	</h:form>
	<br />
	<p:separator />
	<br />
	<iframe width="100%" frameborder="0" name="ifrm01" id="ifrm01"
		src="#{ApplyItemTransferSiteBean.itemTransferSiteForm.signHistoryUrl}"
		onload="document.getElementById('ifrm01').height=ifrm01.document.body.scrollHeight+'px'" />
</ui:composition>
