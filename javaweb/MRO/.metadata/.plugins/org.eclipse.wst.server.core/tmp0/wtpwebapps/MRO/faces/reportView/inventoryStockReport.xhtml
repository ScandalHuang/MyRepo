<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui" 
	xmlns:i18n="http://innolux.com/i18n">
	<h:form id="iSform" prependId="false">
		<div align="center">
			<p:panelGrid id="iStockSearch" columns="2"
				style="width:100%;word-break:break-all;text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="iinventory.avstock" />
				</f:facet>
				<p:column>
					<i18n:outputText value="itemnum" />
				</p:column>
				<p:column>
				</p:column>
				<p:column>
					<p:inputText value="#{InventoryStockReportBean.form.itemnum}" />
				</p:column>
				<p:column>
					<p:commandButton icon="ui-icon-search" value="Search"
						update="iStockList"
						actionListener="#{InventoryStockReportBean.search}" />
				</p:column>
			</p:panelGrid>
			<BR />
			
			<p:dataTable var="iStockList" paginatorPosition="bottom"
				id="iStockList" paginator="true" rows="10"
				value="#{InventoryStockReportBean.form.list}">
				<f:facet name="header">
						<div align="left">
							<ui:repeat var="slinked" value="#{InventoryStockReportBean.form.SLinked}"
									   varStatus="i" >
								<c:set var="linkFlag" 
								value="#{(i.index+1) lt InventoryStockReportBean.form.SLinked.size()? true:false}" />
								<p:commandLink  update=":tabView:iSform:iStockList" rendered="#{linkFlag}"
									actionListener="#{InventoryStockReportBean.getNode(i.index)}" >
								    <h:outputText value="#{slinked.type}" />
								</p:commandLink>
								<h:outputText value="&#160;-->&#160;"  rendered="#{linkFlag}" />
							    <h:outputText value="#{slinked.type}"  rendered="#{!linkFlag}" />
							</ui:repeat>
						</div>
						<div align="right">
							搜尋筆數：#{InventoryStockReportBean.form.list.size()}
						</div>
				</f:facet>
				<p:columns value="#{InventoryStockReportBean.form.columns}"
					var="column" sortBy="#{iStockList[column.property]}"
					style="white-space: pre-wrap; word-wrap: break-word;text-align:center;"
					columnIndexVar="colIndex" >
					<f:facet name="header">
						<h:outputText value="#{column.header}" />
					</f:facet>
					<p:commandLink  rendered="#{column.methodType.getType()=='TYPE0'}" 
						disabled="#{!(iStockList[column.property]>0)}"
						update=":tabView:iSform:iStockList" value="#{iStockList[column.property]}"
						actionListener="#{InventoryStockReportBean.searchType(column.methodType,iStockList)}" />
				    <p:commandLink  rendered="#{column.methodType.getType()=='TYPE1'}" 
				    	value="#{iStockList[column.property]}" 
						actionListener="#{PersonDetailBean.onView(iStockList[column.property])}" />
					<h:outputText rendered="#{column.methodType==null}" 
						value="#{iStockList[column.property]}" />
				</p:columns>
			</p:dataTable>
		</div>
		<p:panelGrid columns="2">
			<p:panel header="Export All Data">
				<h:commandLink>
					<p:graphicImage value="../../resources/images/excel.png" />
					<p:dataExporter type="xls" target="iStockList"
						fileName="#{currentDate.getTime()}E" />
				</h:commandLink>
			</p:panel>
		</p:panelGrid>
	</h:form>
</ui:composition>
