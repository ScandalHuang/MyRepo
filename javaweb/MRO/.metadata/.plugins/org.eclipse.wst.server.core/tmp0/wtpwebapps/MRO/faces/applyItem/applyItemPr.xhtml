
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:i18n="http://innolux.com/i18n">
	<h:form id="PrHeaderForm" prependId="false">

		<h:panelGrid columns="6" cellpadding="2">
			<p:commandButton value="開立新單" update=":tabView"
				icon="ui-icon-plus" actionListener="#{ApplyItemPrBean.NewPr}"
				  />
			<p:commandButton value="儲存" 
				update=":SaveConfirmDialog"
				icon="ui-icon-disk" process="@form"
				rendered="#{ApplyItemPrBean.prForm.editButton}"
				oncomplete="PF('SaveConfirmDialog').show();" />
			<p:commandButton value="送審申請單" icon="ui-icon-circle-check"
				process="@form"
				update=":submitConfirmDialogForm"
				rendered="#{ApplyItemPrBean.prForm.editButton and ApplyItemPrBean.prForm.pr.prid!=null}"
				oncomplete="PF('submitConfirmDialog').show();" />
			<p:commandButton value="取消申請單" icon="ui-icon-close"
				rendered="#{ApplyItemPrBean.prForm.editButton and ApplyItemPrBean.prView.cancelButton}"
				oncomplete="PF('CanConfirmDialog').show();" />
			<p:commandButton value="刪除申請單" icon="ui-icon-trash"
				rendered="#{ApplyItemPrBean.prForm.editButton and ApplyItemPrBean.prForm.pr.prid!=null}"
				oncomplete="PF('deleteConfirmDialog').show();" />
			<p:commandButton value="簽核預覽" icon="ui-icon-search"
				actionListener="#{ApplyItemPrBean.onSignPreView}"
				update=":signPreView"
				rendered="#{ApplyItemPrBean.prForm.editButton and ApplyItemPrBean.prForm.pr.prid!=null}"
				oncomplete="PF('signPreViewDialog').show();" />
		</h:panelGrid>
		<p:separator />
		<i18n:outputText style="color:red;" value="NonNull" />
		<p:panelGrid id="header" style="width:100%;word-break:break-all;">
			<p:row>
				<p:column style="vertical-align:top;width:50%">
					<p:panelGrid style="width:100%;word-break:break-all;">
						<f:facet name="header">
							<p:row>
								<p:column colspan="2">
									<i18n:outputText value="line.info" />
								</p:column>
							</p:row>
						</f:facet>
						<p:row>
							<p:column style="width:120px">
								<i18n:outputText value="apply.num" style="font-weight: bold;" />  :
									</p:column>
							<p:column>
										#{ApplyItemPrBean.prForm.pr.prnum}
									</p:column>
						</p:row>
						<p:row>
							<p:column>
								<i18n:outputText value="item_status" style="font-weight: bold;" /> :
									</p:column>
							<p:column>
										#{SystemConfigBean.parameterMap[ApplyItemPrBean.prForm.pr.status]}
									</p:column>
						</p:row>
						<p:row>
							<p:column>
								<i18n:outputText value="apply.command"
									style="font-weight: bold;" />  :
									</p:column>
							<p:column rendered="#{!ApplyItemPrBean.prForm.editButton}">
										#{ApplyItemPrBean.prForm.pr.description}
									</p:column>
							<p:column rendered="#{ApplyItemPrBean.prForm.editButton}">
								<p:inputText value="#{ApplyItemPrBean.prForm.pr.description}"
									size="45" maxlength="33" />
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<i18n:outputText value="apply.keyin.by"
									style="font-weight: bold;" /> :
									</p:column>
							<p:column>
										#{ApplyItemPrBean.prForm.pr.requestedby}
										<h:outputText
									value="(#{ApplyItemPrBean.prForm.prNameMap[ApplyItemPrBean.prForm.pr.requestedby]})"
									rendered="#{ApplyItemPrBean.prForm.pr.requestedby!=null}" />
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<i18n:outputText style="color:red;" value="NonNullMark" />
								<i18n:outputText value="apply.by" style="font-weight: bold;" />:
									</p:column>
							<p:column
								rendered="#{ApplyItemPrBean.prForm.pr.prid !=null or !ApplyItemPrBean.prForm.editButton}">
									#{ApplyItemPrBean.prForm.pr.requestedby2}
									<h:outputText
									value="(#{ApplyItemPrBean.prForm.prNameMap[ApplyItemPrBean.prForm.pr.requestedby2]})"
									rendered="#{ApplyItemPrBean.prForm.pr.requestedby2!=null}" />
							</p:column>
							<p:column
								rendered="#{ApplyItemPrBean.prForm.pr.prid ==null and ApplyItemPrBean.prForm.editButton }">
								<p:inputText size="25" readonly="true"
									value="#{ApplyItemPrBean.prForm.pr.requestedby2}
									#{ApplyItemPrBean.prForm.prNameMap[ApplyItemPrBean.prForm.pr.requestedby2]}" />
								<p:commandButton icon="ui-icon-search"
									update=":listEmployeeForm"
									actionListener="#{ApplyItemPrBean.onEmployeeList(0)}"
									oncomplete="PF('listEmployeeDialog').show();">
									<f:setPropertyActionListener
										target="#{ListEmployeeBean.object}"
										value="#{ApplyItemPrBean}" />
									<f:setPropertyActionListener
										target="#{ListEmployeeBean.updateView}"
										value="tabView:header" />
								</p:commandButton>
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<i18n:outputText style="color:red;" value="NonNullMark" />
								<i18n:outputText value="site" style="font-weight: bold;" />  :
											</p:column>
							<p:column
								rendered="#{ApplyItemPrBean.prForm.pr.prid !=null or !ApplyItemPrBean.prForm.editButton}">
								<h:outputText
									value="#{SystemConfigBean.locationMapALL[ApplyItemPrBean.prForm.pr.siteid]}"
									rendered="#{ApplyItemPrBean.prForm.pr.siteid!=null}" />
							</p:column>
							<p:column
								rendered="#{ApplyItemPrBean.prForm.pr.prid ==null and ApplyItemPrBean.prForm.editButton}">
								<p:selectOneMenu value="#{ApplyItemPrBean.prForm.pr.siteid}"
									style="width:250px;">
									<f:selectItem itemLabel="請選擇" itemValue="" />
									<f:selectItems value="#{LoginInfoBean.userLMs}" var="userLMs"
										itemLabel="#{userLMs.organizationName}" 
										itemValue="#{userLMs.siteId}" />
								</p:selectOneMenu>
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<i18n:outputText value="Department.Supervisor"
									style="font-weight: bold;" /> :
									</p:column>
							<p:column>
										#{ApplyItemPrBean.prForm.pr.deptsupervisor}
										<h:outputText
									value="(#{ApplyItemPrBean.prForm.prNameMap[ApplyItemPrBean.prForm.pr.deptsupervisor]})"
									rendered="#{ApplyItemPrBean.prForm.pr.deptsupervisor!=null}" />
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<i18n:outputText value="dept_code" style="font-weight: bold;" /> :
									</p:column>
							<p:column>
										#{ApplyItemPrBean.prForm.pr.MDept}
									</p:column>
						</p:row>
						<!-- 2015/05/06  測試報告中決議取消 -->
						<!-- <p:row>
							<p:column>
								<i18n:outputText value="order" style="font-weight: bold;" /> :
									</p:column>
							<p:column rendered="#{!ApplyItemPrBean.prForm.editButton}">
										#{ApplyItemPrBean.prForm.pr.cmopriority}
									</p:column>
							<p:column rendered="#{ApplyItemPrBean.prForm.editButton}">
								<p:selectOneMenu id="cmopriority"
									value="#{ApplyItemPrBean.prForm.pr.cmopriority}"
									style="width:100px;">
									<f:selectItems value="#{ApplyItemPrBean.prForm.priorityOption}" />
								</p:selectOneMenu>
							</p:column>
						</p:row> -->
						<p:row>
							<p:column><i18n:outputText style="color:red;" value="NonNullMark" />
								<i18n:outputText value="apply.classification"
									style="font-weight: bold;" /> :
									</p:column>
									<p:column>
										<h:outputText  rendered="#{ApplyItemPrBean.prForm.pr.prid !=null or !ApplyItemPrBean.prForm.editButton}"
										value="#{SystemConfigBean.parameterMap[ApplyItemPrBean.prForm.pr.prtype]}" />
										
										<p:selectOneMenu value="#{ApplyItemPrBean.prForm.pr.prtype}"  style="width:250px;"
										rendered="#{ApplyItemPrBean.prForm.pr.prid ==null and ApplyItemPrBean.prForm.editButton}" >
											<f:selectItem itemValue="" itemLabel="請選擇" />
											<f:selectItems value="#{ApplyItemPrBean.prForm.prtypeOption}" />
											<p:ajax update="header" process="@form"
												listener="#{ApplyItemPrBean.onSelectPrtype}" />
										</p:selectOneMenu>
									</p:column>
						</p:row>
						<p:row>
							<p:column>
								<i18n:outputText value="apply_date" style="font-weight: bold;" /> :
									</p:column>
							<p:column>
								<h:outputText value="#{ApplyItemPrBean.prForm.pr.issuedate}">
									<f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss"
										timeZone="GMT+8" />
								</h:outputText>
							</p:column>
						</p:row>
						<p:row>
							<p:column>
								<i18n:outputText value="change_date" style="font-weight: bold;" /> :
									</p:column>
							<p:column>
								<h:outputText value="#{ApplyItemPrBean.prForm.pr.changedate}">
									<f:convertDateTime pattern="yyyy-MM-dd HH:mm:ss"
										timeZone="GMT+8" />
								</h:outputText>
							</p:column>
						</p:row>
						<p:row>
							<p:column style="font-weight: bold;">
								<i18n:outputText value="total_cost" />
										(<i18n:outputText value="current.code" />):
									</p:column>
							<p:column>
								<h:outputText rendered="#{ApplyItemPrBean.prForm.pr.status!=null}"
									id="totalbasecost"
									value="#{ApplyItemPrBean.prForm.pr.totalbasecost2}">
								<f:convertNumber groupingUsed="true" />
							</h:outputText>
							</p:column>
						</p:row>
						<p:row rendered="#{ApplyItemPrBean.prForm.unUseBudget!=null}">
							<p:column style="font-weight: bold;">
								<i18n:outputText value="unuse.total.budget" />
										(<i18n:outputText value="current.code" />):
									</p:column>
							<p:column>
								#{ApplyItemPrBean.prForm.unUseBudget}
							</p:column>
						</p:row>
						<p:row rendered="#{ApplyItemPrBean.prForm.reasonFlag}">
							<p:column>
								<i18n:outputText style="color:red;" value="NonNullMark" />
								<i18n:outputText value="apply.purpose" style="font-weight: bold;" />  :
											</p:column>
							<p:column rendered="#{ApplyItemPrBean.prForm.pr.prid !=null or !ApplyItemPrBean.prForm.editButton}">
									#{SystemConfigBean.parameterMap[ApplyItemPrBean.prForm.pr.reasoncode]}
								</p:column>
							<p:column
								rendered="#{ApplyItemPrBean.prForm.pr.prid ==null and ApplyItemPrBean.prForm.editButton }">
								<p:selectOneMenu value="#{ApplyItemPrBean.prForm.pr.reasoncode}"
									style="width:250px;">
									<f:selectItem itemValue="" itemLabel="請選擇" />
									<f:selectItems value="#{ApplyItemPrBean.prForm.applyPurpose}" />
								</p:selectOneMenu>
							</p:column>
						</p:row>
					</p:panelGrid>
				</p:column>
				<p:column style="vertical-align:top;width:50%">
					<p:panelGrid id="countersign" style="width:100%;word-break:break-all;">
						<f:facet name="header">
							<p:row>
								<p:column colspan="2">
									<i18n:outputText value="other.sign" style="font-weight: bold;" />
								</p:column>
							</p:row>
						</f:facet>
						<p:row>
							<p:column style="width:120px;text-align:left;">
								<i18n:outputText value="other.sign1" style="font-weight: bold;" />1  :
									</p:column>
							<p:column rendered="#{!ApplyItemPrBean.prForm.editButton}">
									#{ApplyItemPrBean.prForm.pr.countersign1}
									<h:outputText
									value="(#{ApplyItemPrBean.prForm.prNameMap[ApplyItemPrBean.prForm.pr.countersign1]})"
									rendered="#{ApplyItemPrBean.prForm.pr.countersign1!=null}" />
							</p:column>
							<p:column rendered="#{ApplyItemPrBean.prForm.editButton}">
								<p:inputText size="25" readonly="true"
									value="#{ApplyItemPrBean.prForm.pr.countersign1}
									#{ApplyItemPrBean.prForm.prNameMap[ApplyItemPrBean.prForm.pr.countersign1]}" />
								<p:commandButton icon="ui-icon-search"
									update=":listEmployeeForm"
									actionListener="#{ApplyItemPrBean.onEmployeeList(1)}"
									oncomplete="PF('listEmployeeDialog').show();">
									<f:setPropertyActionListener
										target="#{ListEmployeeBean.object}"
										value="#{ApplyItemPrBean}" />
									<f:setPropertyActionListener
										target="#{ListEmployeeBean.updateView}"
										value="tabView:header" />
								</p:commandButton>
								<p:commandButton icon="ui-icon-close"
									rendered="#{ApplyItemPrBean.prForm.editButton}"
									actionListener="#{ApplyItemPrBean.onEmployeeClear(1)}"
									update=":tabView:PrHeaderForm:countersign">
								</p:commandButton>
							</p:column>
						</p:row>
						<p:row>
							<p:column style="width:120px;text-align:left;">
								<i18n:outputText value="other.sign1" style="font-weight: bold;" />2  :
									</p:column>
							<p:column rendered="#{!ApplyItemPrBean.prForm.editButton}">
									#{ApplyItemPrBean.prForm.pr.countersign2}
									<h:outputText
									value="(#{ApplyItemPrBean.prForm.prNameMap[ApplyItemPrBean.prForm.pr.countersign2]})"
									rendered="#{ApplyItemPrBean.prForm.pr.countersign2!=null}" />
							</p:column>
							<p:column rendered="#{ApplyItemPrBean.prForm.editButton}">
								<p:inputText size="25" readonly="true"
									value="#{ApplyItemPrBean.prForm.pr.countersign2}
									#{ApplyItemPrBean.prForm.prNameMap[ApplyItemPrBean.prForm.pr.countersign2]}" />
								<p:commandButton icon="ui-icon-search"
									update=":listEmployeeForm"
									actionListener="#{ApplyItemPrBean.onEmployeeList(2)}"
									oncomplete="PF('listEmployeeDialog').show();">
									<f:setPropertyActionListener
										target="#{ListEmployeeBean.object}"
										value="#{ApplyItemPrBean}" />
									<f:setPropertyActionListener
										target="#{ListEmployeeBean.updateView}"
										value="tabView:header" />
								</p:commandButton>
								<p:commandButton icon="ui-icon-close"
									rendered="#{ApplyItemPrBean.prForm.editButton}"
									actionListener="#{ApplyItemPrBean.onEmployeeClear(2)}"
									update=":tabView:PrHeaderForm:countersign">
								</p:commandButton>
							</p:column>
						</p:row>
					</p:panelGrid>
					<p:panelGrid id="file" style="margin-top:20px;width:100%;word-break:break-all;">
						<f:facet name="header">
							<p:row>
								<p:column colspan="2">
									<i18n:outputText value="file" style="font-weight: bold;" />
									<!-- font color="red">(上傳檔案前請先點選儲存)</font-->
									<i18n:outputText value="Notice.toUploadAttachement"
										rendered="#{ApplyItemPrBean.prForm.pr.prid==null}"
										style="color:red;text-align:center" />
								</p:column>
							</p:row>
						</f:facet>
						<p:row>
							<p:column style="width:100px;text-align:left;">
								<i18n:outputText value="attachmentList" style="font-weight: bold;" />  :
									</p:column>
							<p:column>
								<p:commandButton icon="ui-icon-disk"
									value="(#{ApplyItemPrBean.prForm.dowloadFileMap[
									ApplyItemPrBean.prForm.fileHeaderType]})"
									action="#{FileUploadBean.onFileType(2,3,
									ApplyItemPrBean.prForm.fileHeaderType,
									ApplyItemPrBean.prForm.pr.prid,
									ApplyItemPrBean.prForm.dowloadFileMap,'tabView:file',
									ApplyItemPrBean.prForm.editButton)}"
									rendered="#{ApplyItemPrBean.prForm.pr.prid!=null}" />
							</p:column>
						</p:row>
					</p:panelGrid>
					<p:panelGrid  style="margin-top:20px;width:100%;">
						<f:facet name="header">
							<p:row>
								<p:column colspan="2">
									<i18n:outputText value="extra.remark" style="font-weight: bold;" />
								</p:column>
							</p:row>
						</f:facet>
						<p:row>
							<p:column style="width:100px;text-align:left;">
								<i18n:outputText value="extra.remark" style="font-weight: bold;" />  :
									</p:column>
							<p:column rendered="#{!ApplyItemPrBean.prForm.editButton}">
								<p:inputTextarea rows="7" cols="50"
									value="#{ApplyItemPrBean.prForm.pr.extraRemark}" autoResize="false"
									readonly="true" />
							</p:column>
							<p:column rendered="#{ApplyItemPrBean.prForm.editButton}">
								<p:inputTextarea rows="7" cols="50" maxlength="1000"
									value="#{ApplyItemPrBean.prForm.pr.extraRemark}" autoResize="false" />
							</p:column>
						</p:row>
					</p:panelGrid>
				</p:column>
			</p:row>
		</p:panelGrid>

		<br />
		<p:separator />
		<br />
		<p:dataTable var="listPrline" id="listPrline"
			value="#{ApplyItemPrBean.prForm.listPrline}" paginatorPosition="bottom"
			paginator="true" rows="10" rowKey="#{listPrline.prlinenum}"
			selection="#{ApplyItemPrBean.prForm.deleteListPrline}"
			rowStyleClass="#{ApplyItemPrBean.prForm.lineErrorMap[listPrline.itemnum]!=null ? 'lineColored' : null}">
			<f:facet name="header">
				<p:row>
					<p:column colspan="2">
						<i18n:outputText value="Apply.Detail" />
						<!-- font color="red">(新增申請項目前，請先點選儲存)</font-->
						<i18n:outputText value="Notice.toAddNewPrline"
							rendered="#{ApplyItemPrBean.prForm.pr.prid==null}"
							style="color:red;text-align:center" />
						<br />
						<i18n:outputText value="add.item" var="add">
							<p:commandButton icon="ui-icon-plus" value="#{add}"
								rendered="#{ApplyItemPrBean.prForm.editButton and 
													ApplyItemPrBean.prForm.pr.prid!=null}"
								actionListener="#{ListPrlineBean.addPrLine(ApplyItemPrBean.prForm.maxPrlineNum,
											ApplyItemPrBean.prForm)}"
								update=":listPrLineForm"
								oncomplete="PF('listPrlineDialog').show();">
								<f:setPropertyActionListener target="#{ListPrlineBean.prLineForm.object}"
									value="#{ApplyItemPrBean}" />
								<f:setPropertyActionListener
									target="#{ListPrlineBean.prLineForm.updateView}"
									value="tabView:PrHeaderForm" />
							</p:commandButton>
						</i18n:outputText>
						<i18n:outputText value="delete.item" var="delete">
							<p:commandButton icon="ui-icon-trash" value="#{delete}"
								rendered="#{ApplyItemPrBean.prForm.editButton and
											        ApplyItemPrBean.prForm.pr.prid!=null}"
								actionListener="#{ApplyItemPrBean.deletePrLine}"
								update=":tabView:PrHeaderForm:listPrline 
											:tabView:PrHeaderForm:totalbasecost" />
						</i18n:outputText>
					</p:column>
				</p:row>
			</f:facet>

			<p:column selectionMode="multiple"
				style="text-align:center;width:20px"
				rendered="#{ApplyItemPrBean.prForm.editButton}" />
			<p:column style="text-align:center;width:20px;">
				<f:facet name="header">

				</f:facet>
				<p:commandButton icon="ui-icon-search"
					style="width:20px;height:20px;"
					update=":listPrLineForm"
					rendered="#{!ApplyItemPrBean.prForm.editButton}"
					actionListener="#{ListPrlineBean.onPrLine(listPrline,
							      ApplyItemPrBean.prForm.editButton,ApplyItemPrBean.prForm)}"
					oncomplete="PF('listPrlineDialog').show();" title="Search" />
				<!-- added by r.c. -->
				<p:commandButton icon="ui-icon-pencil"
					style="width:20px;height:20px;"
					update=":listPrLineForm"
					rendered="#{ApplyItemPrBean.prForm.editButton}"
					actionListener="#{ListPrlineBean.onPrLine(listPrline,
							      ApplyItemPrBean.prForm.editButton,ApplyItemPrBean.prForm)}"
					oncomplete="PF('listPrlineDialog').show();" title="Edit">
					<f:setPropertyActionListener target="#{ListPrlineBean.prLineForm.object}"
						value="#{ApplyItemPrBean}" />
					<f:setPropertyActionListener target="#{ListPrlineBean.prLineForm.updateView}"
						value="tabView:PrHeaderForm" />
				</p:commandButton>
				<!-- end of aded -->
			</p:column>
			<p:column filterMatchMode="contains" style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="line" />
				</f:facet>
				<h:outputText value="#{listPrline.prlinenum}" />

			</p:column>
			<p:column filterMatchMode="contains" style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="itemnum" />
				</f:facet>
				<h:outputText value="#{listPrline.itemnum}" />
			</p:column>
			<p:column filterMatchMode="contains">
				<f:facet name="header">
					<i18n:outputText value="item.description" />
					<i18n:outputText value="description" />
				</f:facet>
				<h:outputText value="#{listPrline.description}" 
					style="white-space: pre-wrap; word-wrap: break-word; "/>

			</p:column>
			<!-- added by r.c -->
			<p:column filterMatchMode="contains" style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="min.Basic.Unit" />
				</f:facet>
				<h:outputText value="#{listPrline.minBasicUnit}" />

			</p:column>
			<!-- end of added -->
			<p:column filterMatchMode="contains" style="text-align:center;"
				rendered="#{ApplyItemPrBean.prView.pmreqqty}">
				<f:facet name="header">
					<i18n:outputText value="request.quantity" />
				</f:facet>
				<h:outputText value="#{listPrline.pmreqqty}" />

			</p:column>
			<p:column filterMatchMode="contains" style="text-align:center;"
				rendered="#{ApplyItemPrBean.prView.minlevel}">
				<f:facet name="header">
					<i18n:outputText value="add.mon.minlevel" />
				</f:facet>
				<h:outputText value="#{listPrline.minlevel}" />

			</p:column>
			<p:column filterMatchMode="contains" style="text-align:center;"
				rendered="#{ApplyItemPrBean.prView.newminlevel}">
				<f:facet name="header">
					<i18n:outputText value="NEWMINLEVEL" />
				</f:facet>
				<h:outputText value="#{listPrline.newminlevel}" />

			</p:column>
			<p:column filterMatchMode="contains" style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="unit_cost" />
				</f:facet>
				<h:outputText value="#{listPrline.unitcost}" >
								<f:convertNumber groupingUsed="true" />
							</h:outputText>

			</p:column>
			<p:column filterMatchMode="contains" style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="pr_line_cost" />
				</f:facet>
				<h:outputText value="#{listPrline.linecost}" >
								<f:convertNumber groupingUsed="true" />
							</h:outputText>
			</p:column>
			<p:column  style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="file" />
				</f:facet>
				<i18n:outputText value="Notice.toUploadAttachement"
					rendered="#{listPrline.prlineid==null}"
					style="color:red;text-align:center" />
				<p:commandButton icon="ui-icon-disk"
					value="(#{ApplyItemPrBean.prForm.dowloadFileMap[listPrline.prlineid]})"
					action="#{FileUploadBean.onFileType(2,1,
							ApplyItemPrBean.prForm.fileLineType,
							listPrline.prlineid,
							ApplyItemPrBean.prForm.dowloadFileMap,'tabView:listPrline',
							ApplyItemPrBean.prForm.editButton)}"
					rendered="#{listPrline.prlineid!=null}" />
			</p:column>
		</p:dataTable>
		<br />
		<p:separator />
		<br />
		<p:dataTable var="listClosePrline" id="listClosePrline"
			value="#{ApplyItemPrBean.prForm.listClosePrline}"
			rendered="#{ApplyItemPrBean.prForm.listClosePrline.size()>0}"
			paginatorPosition="bottom" paginator="true" rows="10"
			rowKey="#{listClosePrline.prlineid}">
			<f:facet name="header">
				<p:row>
					<p:column colspan="2">
						<i18n:outputText value="Delete.Detail" />
					</p:column>
				</p:row>
			</f:facet>
			<p:column style="text-align:center;width:20px;">
				<f:facet name="header">

				</f:facet>
				<p:commandButton icon="ui-icon-search"
					style="width:20px;height:20px;"
					update=":listPrLineForm"
					actionListener="#{ListPrlineBean.onPrLine(listClosePrline,
							      false,ApplyItemPrBean.prForm)}"
					 
					oncomplete="PF('listPrlineDialog').show();" />
			</p:column>
			<p:column style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="line" />
				</f:facet>
				<h:outputText value="#{listClosePrline.prlinenum}" />

			</p:column>
			<p:column style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="itemnum" />
				</f:facet>
				<h:outputText value="#{listClosePrline.itemnum}" />
			</p:column>
			<p:column>
				<f:facet name="header">
					<i18n:outputText value="item.description" />
					<i18n:outputText value="description" />
				</f:facet>
				<h:outputText value="#{listClosePrline.description}"
					style="white-space: pre-wrap; word-wrap: break-word; " />

			</p:column>
			<!-- added by r.c -->
			<p:column style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="min.Basic.Unit" />
				</f:facet>
				<h:outputText value="#{listClosePrline.minBasicUnit}" />

			</p:column>
			<p:column style="text-align:center;"
				rendered="#{ApplyItemPrBean.prView.cPmreqqty}">
				<f:facet name="header">
					<i18n:outputText value="request.quantity" />
				</f:facet>
				<h:outputText value="#{listClosePrline.pmreqqty}" />

			</p:column>
			<p:column filterMatchMode="contains" style="text-align:center;"
				rendered="#{ApplyItemPrBean.prView.cMinlevel}">
				<f:facet name="header">
					<i18n:outputText value="add.mon.minlevel" />
				</f:facet>
				<h:outputText value="#{listClosePrline.minlevel}" />

			</p:column>
			<p:column filterMatchMode="contains" style="text-align:center;"
				rendered="#{ApplyItemPrBean.prView.cNewminlevel}}">
				<f:facet name="header">
					<i18n:outputText value="NEWMINLEVEL" />
				</f:facet>
				<h:outputText value="#{listClosePrline.newminlevel}" />

			</p:column>
			<p:column style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="unit_cost" />
				</f:facet>
				<h:outputText value="#{listClosePrline.unitcost}" >
								<f:convertNumber groupingUsed="true" />
							</h:outputText>

			</p:column>
			<p:column style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="pr_line_cost" />
				</f:facet>
				<h:outputText value="#{listClosePrline.linecost}" >
								<f:convertNumber groupingUsed="true" />
							</h:outputText>

			</p:column>
			<p:column style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="file" />
				</f:facet>
				<p:commandButton icon="ui-icon-disk"
					value="(#{ApplyItemPrBean.prForm.dowloadFileMap[listClosePrline.prlineid]})"
					action="#{FileUploadBean.view(listClosePrline.prlineid,
									ApplyItemPrBean.prForm.fileLineType)}"
					rendered="#{listClosePrline.prlineid!=null}"/>
			</p:column>
			<p:column style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="signer" />
				</f:facet>
				<h:outputText
					value="#{ApplyItemPrBean.prForm.prNameMap[listClosePrline.changeBy]}" />
			</p:column>
			<p:column style="text-align:center;">
				<f:facet name="header">
					<i18n:outputText value="close.remark" />
				</f:facet>
				<h:outputText value="#{listClosePrline.closeRemark}"
					style="white-space: pre-wrap; word-wrap: break-word; "   />
			</p:column>
		</p:dataTable>
	</h:form>
	<br />
	<p:separator />
	<br />
	<iframe width="100%" frameborder="0" name="ifrm01" id="ifrm01"
		src="#{ApplyItemPrBean.prForm.signHistoryUrl}"
		onload="document.getElementById('ifrm01').height=ifrm01.document.body.scrollHeight+'px'" />
</ui:composition>
